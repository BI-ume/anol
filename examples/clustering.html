<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Animated Clustering Example</title>
    <!-- Core CSS -->
    <link href="../build/css/bootstrap.css" rel="stylesheet">
    <link href="../build/css/ol.css" rel="stylesheet">
    <link href="../build/css/anol.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body ng-app="example">
    <!-- map -->
    <div anol-map style="width:600px; height: 400px; border: 1px solid black;">
        <div anol-zoom></div>
    </div>
    <!-- Remove libs when build dist -->
    <script type="text/javascript" src="../build/jquery.js"></script>
    <script type="text/javascript" src="../build/angular.js"></script>
    <script type="text/javascript" src="../build/angular-sanitize.js"></script>
    <script type="text/javascript" src="../build/ui-bootstrap-tpls.js"></script>
    <script type="text/javascript" src="../build/angular-translate.js"></script>
    <script type="text/javascript" src="../build/ol-custom.js"></script>
    <script type="text/javascript" src="../build/anol.js"></script>
    <script type="text/javascript">
    angular.module('example', ['anol.zoom'])
        .config(['MapServiceProvider', 'LayersServiceProvider',
            function(MapServiceProvider, LayersServiceProvider) {
                MapServiceProvider.addView(new ol.View({
                    center: [0, 0],
                    zoom: 14
                }));

                var iconStyles = [
                    new ol.style.Style({
                        image: new ol.style.Circle({
                            fill: new ol.style.Fill({
                                color: 'rgba(200,0,0,0.4)'
                            }),
                            stroke: new ol.style.Stroke({
                                color: 'rgba(200,0,0,1)',
                                width: 1
                            }),
                            radius: 3
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(200,0,0,0.4)'
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'rgba(200,0,0,1)',
                            width: 1
                        })
                    }),
                    new ol.style.Style({
                        image: new ol.style.Circle({
                            fill: new ol.style.Fill({
                                color: 'rgba(0,200,0,0.4)'
                            }),
                            stroke: new ol.style.Stroke({
                                color: 'rgba(0,200,0,1)',
                                width: 1
                            }),
                            radius: 3
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(0,200,0,0.4)'
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'rgba(0,200,0,1)',
                            width: 1
                        })
                    }),
                    new ol.style.Style({
                        image: new ol.style.Circle({
                            fill: new ol.style.Fill({
                                color: 'rgba(0,0,200,0.4)'
                            }),
                            stroke: new ol.style.Stroke({
                                color: 'rgba(0,0,200,1)',
                                width: 1
                            }),
                            radius: 3
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(0,0,200,0.4)'
                        }),
                        stroke: new ol.style.Stroke({
                            color: 'rgba(0,0,200,1)',
                            width: 1
                        })
                    })
                ];

                var points = [];
                var e = 500;
                var count = 50;
                for (var i = 0; i < count; i++) {
                    var coordinates = [
                        2 * e * Math.random() - e,
                        2 * e * Math.random() - e
                    ];
                    var f = new ol.Feature({
                        geometry: new ol.geom.Point(coordinates),
                        id: i
                    });
                    f.setStyle(iconStyles[i % 3]);
                    points.push(f);
                }

                var clusterLayer = new anol.layer.Feature({
                    name: 'clusteredLayer',
                    cluster: {
                        pointRadius: 12,
                        clusterStyle: function(feature, resolution) {
                            var style = new ol.style.Style({
                                image: new ol.style.Circle({
                                    fill: new ol.style.Fill({
                                        color: 'rgba(200,200,0,0.4)'
                                    }),
                                    stroke: new ol.style.Stroke({
                                        color: 'rgba(200,200,0,1)',
                                        width: 1
                                    }),
                                    radius: 5
                                }),
                                fill: new ol.style.Fill({
                                    color: 'rgba(200,200,0,0.4)'
                                }),
                                stroke: new ol.style.Stroke({
                                    color: 'rgba(200,200,0,1)',
                                    width: 1
                                }),
                                text: new ol.style.Text({
                                    text: feature.get('features').length.toString()
                                })
                            });
                            return [style];
                        },
                        selectClusterStyle: function(feature, resolution) {
                            var style = new ol.style.Style({
                                image: new ol.style.Circle({
                                    fill: new ol.style.Fill({
                                        color: 'rgba(200,0,200,0.4)'
                                    }),
                                    stroke: new ol.style.Stroke({
                                        color: 'rgba(200,0,200,1)',
                                        width: 1
                                    }),
                                    radius: 10
                                }),
                                fill: new ol.style.Fill({
                                    color: 'rgba(200,0,200,0.4)'
                                }),
                                stroke: new ol.style.Stroke({
                                    color: 'rgba(200,0,200,1)',
                                    width: 1
                                }),
                                text: new ol.style.Text({
                                    text: feature.get('features').length.toString()
                                })
                            });
                            return [style];
                        },
                        onSelect: function(features) {
                            if(features.length === 1) {
                                console.log('feature', features[0].get('id'), 'selected');
                            } else {
                                var ids = [];
                                angular.forEach(features, function(f) {
                                    ids.push(f.get('id'));
                                });
                                console.log('features with ids', ids, 'selected');
                            }
                        }
                    },
                    olLayer: {
                        source: {
                            features: points
                        }
                    }
                });

                var wms = new anol.layer.TiledWMS({
                    isBackground: true,
                    olLayer: {
                        source: {
                            url: 'http://maps.omniscale.net/wms/demo/default/service?',
                            params: {
                                'LAYERS': 'osm',
                                'SRS': 'EPSG:3857'
                            }
                        }
                    }
                });
                LayersServiceProvider.setLayers([clusterLayer, wms]);
            }
        ]);
    </script>
</body>

</html>
